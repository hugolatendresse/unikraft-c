spec: v0.6

name: blockio-test

unikraft:
  version: stable
  kconfig:
    # Block device support - DIRECT ACCESS (no VFS)
    CONFIG_LIBUKBLKDEV: 'y'
    CONFIG_LIBUKBLKDEV_SYNC_IO_BLOCKED_WAITING: 'y'
    
    # virtio support
    CONFIG_VIRTIO_BUS: 'y'
    CONFIG_VIRTIO_PCI: 'y'
    CONFIG_VIRTIO_BLK: 'y'
    
    # Scheduler (required for sync I/O semaphores)
    CONFIG_LIBUKSCHEDCOOP: 'y'
    
    # Disable ALL VFS automount features (vfscore is pulled in by musl but we don't use it)
    CONFIG_LIBVFSCORE_AUTOMOUNT_CI: 'n'
    CONFIG_LIBVFSCORE_AUTOMOUNT_UP: 'n'
    CONFIG_LIBVFSCORE_AUTOMOUNT_FB: 'n'
    CONFIG_LIBVFSCORE_AUTOMOUNT: 'n'
    CONFIG_LIBVFSCORE_AUTOUNMOUNT: 'n'
    CONFIG_LIBDEVFS_AUTOMOUNT: 'n'
    
    # Debug output
    CONFIG_LIBUKDEBUG_PRINTK_INFO: 'y'

libraries:
  musl: stable

targets:
  - platform: qemu
    architecture: x86_64

cmd: ["/blockio-test"]
